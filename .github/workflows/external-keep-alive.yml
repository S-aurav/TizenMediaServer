name: 🔗 External CRON Trigger
on:
  workflow_dispatch:
    inputs:
      source:
        description: 'Trigger source'
        required: false
        default: 'external'
        type: string
  schedule:
    # Keep existing schedule as backup (but less reliable)
    - cron: '*/10 4-15 * * *'  # Every 10 minutes from 4:30 AM to 3:30 PM UTC (10 AM - 9 PM IST)

jobs:
  external-keep-alive:
    runs-on: ubuntu-latest
    
    steps:
    - name: 🚀 External CRON Keep-Alive Ping
      run: |
        echo "🔗 Triggered by: ${{ github.event.inputs.source || 'github-cron' }}"
        echo "⏰ Trigger time: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        echo "🎯 Source: External CRON Service (UptimeRobot)"
        
        # Ping the server
        response=$(curl -s -o /dev/null -w "%{http_code}" "${{ secrets.RENDER_SERVER_URL }}/health" || echo "000")
        
        if [ "$response" = "200" ]; then
          echo "✅ Server is awake and healthy!"
          echo "::notice::External CRON ping successful - Server responding"
        else
          echo "⚠️ Server responded with status: $response"
          echo "::warning::Server may be sleeping or having issues"
          
          # Try to wake up with a second request
          echo "🔄 Attempting wake-up ping..."
          sleep 5
          response2=$(curl -s -o /dev/null -w "%{http_code}" "${{ secrets.RENDER_SERVER_URL }}/health" || echo "000")
          
          if [ "$response2" = "200" ]; then
            echo "✅ Server woke up successfully on second ping!"
            echo "::notice::Server awakened by external CRON trigger"
          else
            echo "❌ Server still not responding after wake-up attempt"
            echo "::error::Server may be down or experiencing issues"
          fi
        fi
        
        echo ""
        echo "📊 External CRON Stats:"
        echo "🕐 Trigger time: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
        echo "⏰ Active hours: 10 AM - 9 PM IST (4:30 AM - 3:30 PM UTC)"
        echo "🎯 Trigger method: External CRON (UptimeRobot)"
        echo "🔄 Frequency: Every 10 minutes (more reliable than GitHub)"
        echo "📈 Expected reliability: 99.9%"
        echo "🛡️ Backup: GitHub CRON still active"